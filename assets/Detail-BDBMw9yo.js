import{d as V,b$ as N,c as F,o as L,f as P,h as c,i as t,w as a,k as m,t as A,m as G,y as H,a as j,u as q,G as J,E as r,C as B,H as K,e as u}from"./index-Cs6km2Mj.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"work"},W={class:"header"},X={class:"flex items-center"},Y={class:"main"},Z={style:{"margin-left":"2px"}},ee={__name:"Detail",setup(te){const w=H(),p=j(),R=q(),x=w.params.index,d=w.params.file_id,i=V({user_id:"",file_id:d,is_created:!1,is_enable_ai:!1,file_name:"",file_data:{class_name:"",tile:"",list:[{title:"",desc:""}]}}),s=V({title:"",desc:""}),S=()=>{J(d).then(l=>{if(l.data.code!=1)return r({message:"同步文件信息失败",type:"error"});i.value=l.data.data,s.value=i.value.file_data.list[x]})},k=p.state.file_list.find(l=>l.file_id==d);k?(i.value=k,s.value=i.value.file_data.list[x]):S();const $=()=>{B.confirm("使用标准段落将会清空当前段落，您确定吗？","使用标准段落",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value.paragraphs=[{title:"一、实验目的",desc:""},{title:"二、实验仪器设备或材料",desc:""},{title:"三、实验原理",desc:""},{title:"四、实验内容与步骤",desc:""},{title:"五、实验结果与分析",desc:""},{title:"六、结论与体会",desc:""},{title:"七、教师评语",desc:""}],r({type:"success",message:"使用成功"})}).catch(()=>{r({type:"success",message:"已取消使用"})})},T=()=>{B.confirm("确定要清空当前实验报告吗？","清空文档",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value.title="",s.value.desc="",s.value.paragraphs=[],r({type:"success",message:"清空成功"})}).catch(()=>{r({type:"success",message:"已取消清空"})})},C=(l,e)=>{if(!s.value.paragraphs)return s.value.paragraphs=[{...l}];if(e==-1)return s.value.paragraphs.push({...l});s.value.paragraphs.splice(e,0,{...l})},U=l=>{s.value.paragraphs.splice(l,1)},I=async()=>{if(f.value=60*3,i.value.file_name=="")return r({message:"文件名不能为空",type:"error"});i.value.file_data.list[x]=s.value;const l=await K(d,i.value);if(l.data.code!=1)return r({message:l.data.msg,type:"error"});let e=p.state.file_list,n=e.findIndex(_=>_.file_id==d);e[n]=i.value,p.commit("setFileList",e),r({message:"保存成功",type:"success",duration:1100})},h=()=>{let l=p.state.file_list,e=l.findIndex(n=>n.file_id==d);i.value.file_data.list[x]=s.value,l[e]=i.value,p.commit("setFileList",l),R.push(`/report/${d}`)};let f=V(60*3);setInterval(()=>f.value--,1e3),N(f,(l,e)=>l==0&&saveReport());let z=F(()=>{const l=Math.floor(f.value/60),e=f.value%60,n=String(l).padStart(2,"0"),_=String(e).padStart(2,"0");return`${n}:${_}`});return(l,e)=>{const n=u("el-button"),_=u("el-page-header"),y=u("el-input"),v=u("el-form-item"),b=u("el-table-column"),E=u("el-popconfirm"),M=u("el-table"),D=u("el-form");return L(),P("div",Q,[c("div",W,[t(_,{onBack:h,title:i.value.file_name,icon:null},{content:a(()=>e[3]||(e[3]=[c("span",{class:"text-large font-600 mr-3"},"编辑详情",-1)])),extra:a(()=>[c("div",X,[t(n,{onClick:$,type:"primary",class:"ml-2"},{default:a(()=>e[4]||(e[4]=[m("标准段落")])),_:1}),t(n,{onClick:T,type:"danger",class:"ml-2"},{default:a(()=>e[5]||(e[5]=[m("清空")])),_:1})])]),_:1},8,["title"])]),c("div",Y,[t(D,{model:s.value,"label-width":"auto"},{default:a(()=>[t(v,{label:"实验标题"},{default:a(()=>[t(y,{modelValue:s.value.title,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.title=o)},null,8,["modelValue"])]),_:1}),t(v,{label:"实验简介"},{default:a(()=>[t(y,{modelValue:s.value.desc,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.desc=o),autosize:{minRows:2,maxRows:5},type:"textarea"},null,8,["modelValue"])]),_:1}),t(v,{label:"段落设计"},{default:a(()=>[t(M,{data:s.value.paragraphs,"max-height":"386",border:!0},{default:a(()=>[t(b,{type:"index",align:"center"}),t(b,{label:"段落标题",align:"center"},{default:a(o=>[t(y,{modelValue:o.row.title,"onUpdate:modelValue":g=>o.row.title=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{label:"段落文本",align:"center"},{default:a(o=>[t(y,{modelValue:o.row.desc,"onUpdate:modelValue":g=>o.row.desc=g,autosize:{minRows:1,maxRows:4},type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{label:"操作",align:"center"},{default:a(o=>[t(n,{onClick:g=>C(o.row,o.$index),size:"small"},{default:a(()=>e[6]||(e[6]=[m("复制")])),_:2},1032,["onClick"]),t(E,{onConfirm:g=>U(o.$index),title:"确认要删除该项吗？","confirm-button-text":"确认","cancel-button-text":"取消"},{reference:a(()=>[t(n,{size:"small",type:"danger"},{default:a(()=>e[7]||(e[7]=[m("删除")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),t(v,null,{default:a(()=>[t(n,{onClick:e[2]||(e[2]=o=>C({title:"",desc:""},-1))},{default:a(()=>e[8]||(e[8]=[m("添加段落")])),_:1})]),_:1}),t(v,null,{default:a(()=>[t(n,{onClick:h},{default:a(()=>e[9]||(e[9]=[m("返回")])),_:1}),t(n,{type:"primary",onClick:I},{default:a(()=>[e[10]||(e[10]=c("span",null,"保存",-1)),c("span",Z,A(G(z)),1)]),_:1})]),_:1})]),_:1},8,["model"])])])}}},se=O(ee,[["__scopeId","data-v-94ece5c4"]]);export{se as default};
