import{c,d as v,b as Y,r as P,o as y,f as Z,h as V,i as a,w as r,k as m,m as o,j as C,F as ee,u as te,a as ae,cm as le,E as u,cn as re,e as i,n as B,co as oe,U as se}from"./index-Cs6km2Mj.js";import{a as ne,p as de,b as ue,e as F}from"./reg-Boiy3YJL.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"work"},me={class:"header"},_e={class:"main"},fe={class:"user_avatar"},ge={__name:"Index",setup(we){const M=te(),f=ae(),N=c(()=>f.state.user.is_have_avatar),j=c(()=>f.state.user.user_id),z=c(()=>f.state.update_avatar);let n=v({user_name:"",user_age:18,user_gender:"",user_phone:"",user_email:""}),p=v({old_pwd:"",new_pwd:"",renew_pwd:""});Y().then(l=>{delete l.data.data.user_id,delete l.data.data.file_list,delete l.data.data.is_have_avatar,n.value=l.data.data,console.log(n.value)});const E=async l=>{l&&l.validate(async e=>{e?le(n.value).then(t=>{if(t.data.code!=1)return u({message:t.data.msg,type:"error"});u({message:t.data.msg,type:"success"})}):u({message:"格式校验未通过",type:"error"})})},I=async l=>{l&&l.validate(async e=>{e?re(p.value).then(t=>{if(t.data.code!=1)return u({message:t.data.msg,type:"error"});u({message:t.data.msg,type:"success",duration:1200,onClose(){g.value=!1}})}):u({message:"格式校验未通过",type:"error"})})},S=l=>l.type!="image/jpeg"&&l.type!="image/png"?(u.error("请选择jpg或png格式头像"),!1):l.size/1024/1024>2?(u.error("头像不能大于2MB"),!1):!0,T=l=>{f.commit("setUser",l.data),f.commit("updateAvatar"),u({message:l.msg,type:"success"})},D=l=>{u({message:l.msg,type:"error"})},L=(l,e,t)=>{if(!ne(e))return t("请输入正确的年龄");t()},$=(l,e,t)=>{if(e.length==0)return t();if(!de(e))return t("请输入正确的手机号");t()},H=(l,e,t)=>{if(e.length==0)return t();if(!ue(e))return t("请输入正确的邮箱");t()},O=(l,e,t)=>{if(e.length==0)return t();if(!F(e))return t("密码只能为英文和数字");if(e.length<6||e.length>16)return t("密码长度必须在6到16个字符之间");t()},q=(l,e,t)=>{if(e.length==0)return t();if(!F(e))return t("密码只能为英文和数字");if(e.length<6||e.length>16)return t("密码长度必须在6到16个字符之间");t()},G=(l,e,t)=>{if(e.length==0)return t();if(e!=p.value.new_pwd)return t("两次密码不一致");t()},R=v(),J=P({user_age:[{validator:L,trigger:"blur"}],user_phone:[{validator:$,trigger:"blur"}],user_email:[{validator:H,trigger:"blur"}]}),b=v(),K=P({old_pwd:[{validator:O,trigger:"blur"}],new_pwd:[{validator:q,trigger:"blur"}],renew_pwd:[{validator:G,trigger:"blur"}]}),g=v(!1),U=()=>{g.value=!g.value},k=()=>{M.push("/index/main")};return(l,e)=>{const t=i("el-page-header"),A=i("el-avatar"),Q=i("el-upload"),d=i("el-form-item"),_=i("el-input"),h=i("el-radio"),W=i("el-radio-group"),w=i("el-button"),x=i("el-form"),X=i("el-dialog");return y(),Z(ee,null,[V("div",pe,[V("div",me,[a(t,{onBack:k,title:"主页",icon:null},{content:r(()=>e[11]||(e[11]=[m(" 个人主页 ")])),_:1})]),V("div",_e,[a(x,{ref_key:"userRuleFormRef",ref:R,model:o(n),rules:J,"label-width":"auto"},{default:r(()=>[a(d,{style:{"margin-bottom":"0"}},{default:r(()=>[V("div",fe,[a(Q,{action:o(B).defaults.baseURL+o(oe),headers:{Authorization:"Bearer "+o(f).state.token},"on-success":T,"on-error":D,"before-upload":S,accept:".jpg, .png","show-file-list":!1},{default:r(()=>[N.value?(y(),C(A,{key:z.value,size:70,src:o(B).defaults.baseURL+o(se)+j.value+"?v="+new Date().getTime()},null,8,["src"])):(y(),C(A,{key:1,size:70,src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}))]),_:1},8,["action","headers"])])]),_:1}),a(d,{label:"用户名"},{default:r(()=>[a(_,{disabled:"",modelValue:o(n).user_name,"onUpdate:modelValue":e[0]||(e[0]=s=>o(n).user_name=s)},null,8,["modelValue"])]),_:1}),a(d,{label:"年龄",prop:"user_age"},{default:r(()=>[a(_,{modelValue:o(n).user_age,"onUpdate:modelValue":e[1]||(e[1]=s=>o(n).user_age=s),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"性别"},{default:r(()=>[a(W,{modelValue:o(n).user_gender,"onUpdate:modelValue":e[2]||(e[2]=s=>o(n).user_gender=s)},{default:r(()=>[a(h,{value:"男"},{default:r(()=>e[12]||(e[12]=[m("男")])),_:1}),a(h,{value:"女"},{default:r(()=>e[13]||(e[13]=[m("女")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"联系电话",prop:"user_phone"},{default:r(()=>[a(_,{modelValue:o(n).user_phone,"onUpdate:modelValue":e[3]||(e[3]=s=>o(n).user_phone=s)},null,8,["modelValue"])]),_:1}),a(d,{label:"邮箱",prop:"user_email"},{default:r(()=>[a(_,{modelValue:o(n).user_email,"onUpdate:modelValue":e[4]||(e[4]=s=>o(n).user_email=s)},null,8,["modelValue"])]),_:1}),a(d,null,{default:r(()=>[a(w,{onClick:k},{default:r(()=>e[14]||(e[14]=[m("取消")])),_:1}),a(w,{type:"primary",onClick:e[5]||(e[5]=s=>E(R.value))},{default:r(()=>e[15]||(e[15]=[m("保存")])),_:1}),a(w,{type:"warning",onClick:U,style:{"margin-left":"auto"}},{default:r(()=>e[16]||(e[16]=[m("修改密码")])),_:1})]),_:1})]),_:1},8,["model","rules"])])]),a(X,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=s=>g.value=s),title:"修改密码",width:"800"},{default:r(()=>[a(x,{ref_key:"pwdRuleFormRef",ref:b,model:o(p),rules:K,"label-width":"auto"},{default:r(()=>[a(d,{label:"原密码",prop:"old_pwd"},{default:r(()=>[a(_,{modelValue:o(p).old_pwd,"onUpdate:modelValue":e[6]||(e[6]=s=>o(p).old_pwd=s),modelModifiers:{trim:!0},type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(d,{label:"新密码",prop:"new_pwd"},{default:r(()=>[a(_,{modelValue:o(p).new_pwd,"onUpdate:modelValue":e[7]||(e[7]=s=>o(p).new_pwd=s),modelModifiers:{trim:!0},type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(d,{label:"确认密码",prop:"renew_pwd"},{default:r(()=>[a(_,{modelValue:o(p).renew_pwd,"onUpdate:modelValue":e[8]||(e[8]=s=>o(p).renew_pwd=s),modelModifiers:{trim:!0},type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(d,null,{default:r(()=>[a(w,{onClick:U},{default:r(()=>e[17]||(e[17]=[m("取消")])),_:1}),a(w,{onClick:e[9]||(e[9]=s=>I(b.value)),type:"primary"},{default:r(()=>e[18]||(e[18]=[m("修改")])),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}},ye=ie(ge,[["__scopeId","data-v-974fc2c5"]]);export{ye as default};
