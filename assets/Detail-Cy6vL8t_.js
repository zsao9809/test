import{d as b,b$ as L,c as N,o as P,f as A,h as m,i as t,w as l,k as p,t as j,m as q,y as F,a as G,u as H,E as d,C as B,L as J,e as i}from"./index-Cs6km2Mj.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"work"},Q={class:"header"},W={class:"flex items-center"},X={class:"main"},Y={style:{"margin-left":"2px"}},Z={__name:"Detail",setup(ee){const w=F(),c=G(),S=H(),g=w.params.index,r=w.params.template_id,u=b({user_id:"",template_id:r,template_name:"",template_data:{class_name:"",tile:"",list:[{title:"",desc:""}]}}),s=b({title:"",desc:""}),T=()=>{getReportInfo(r).then(a=>{if(a.data.code!=1)return d({message:"同步模板信息失败",type:"error"});u.value=a.data.data,s.value=u.value.template_data.list[g]})},k=c.state.template_list.find(a=>a.template_id==r);k?(u.value=k,s.value=u.value.template_data.list[g]):T();const $=()=>{B.confirm("使用标准段落将会清空当前段落，您确定吗？","使用标准段落",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value.paragraphs=[{title:"一、实验目的",desc:""},{title:"二、实验仪器设备或材料",desc:""},{title:"三、实验原理",desc:""},{title:"四、实验内容与步骤",desc:""},{title:"五、实验结果与分析",desc:""},{title:"六、结论与体会",desc:""},{title:"七、教师评语",desc:""}],d({type:"success",message:"使用成功"})}).catch(()=>{d({type:"success",message:"已取消使用"})})},R=()=>{B.confirm("确定要清空当前实验报告吗？","清空文档",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value.title="",s.value.desc="",s.value.paragraphs=[],d({type:"success",message:"清空成功"})}).catch(()=>{d({type:"success",message:"已取消清空"})})},C=(a,e)=>{if(!s.value.paragraphs)return s.value.paragraphs=[{...a}];if(e==-1)return s.value.paragraphs.push({...a});s.value.paragraphs.splice(e,0,{...a})},U=a=>{s.value.paragraphs.splice(a,1)},I=async()=>{if(u.value.template_name=="")return d({message:"文件名不能为空",type:"error"});u.value.template_data.list[g]=s.value;const a=await J(r,u.value);if(a.data.code!=1)return d({message:a.data.msg,type:"error"});let e=c.state.template_list,n=e.findIndex(_=>_.template_id==r);e[n]=u.value,c.commit("setTemplateList",e),d({message:"保存成功",type:"success",duration:1100})},h=()=>{let a=c.state.template_list,e=a.findIndex(n=>n.template_id==r);u.value.template_data.list[g]=s.value,a[e]=u.value,c.commit("setTemplateList",a),S.push(`/template/${r}`)};let x=b(60*3);setInterval(()=>x.value--,1e3),L(x,(a,e)=>a==0&&saveReport());let z=N(()=>{const a=Math.floor(x.value/60),e=x.value%60,n=String(a).padStart(2,"0"),_=String(e).padStart(2,"0");return`${n}:${_}`});return(a,e)=>{const n=i("el-button"),_=i("el-page-header"),y=i("el-input"),f=i("el-form-item"),V=i("el-table-column"),E=i("el-popconfirm"),M=i("el-table"),D=i("el-form");return P(),A("div",O,[m("div",Q,[t(_,{onBack:h,title:u.value.template_name,icon:null},{content:l(()=>e[3]||(e[3]=[m("span",{class:"text-large font-600 mr-3"},"编辑详情",-1)])),extra:l(()=>[m("div",W,[t(n,{onClick:$,type:"primary",class:"ml-2"},{default:l(()=>e[4]||(e[4]=[p("标准段落")])),_:1}),t(n,{onClick:R,type:"danger",class:"ml-2"},{default:l(()=>e[5]||(e[5]=[p("清空")])),_:1})])]),_:1},8,["title"])]),m("div",X,[t(D,{model:s.value,"label-width":"auto"},{default:l(()=>[t(f,{label:"实验标题"},{default:l(()=>[t(y,{modelValue:s.value.title,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.title=o)},null,8,["modelValue"])]),_:1}),t(f,{label:"实验简介"},{default:l(()=>[t(y,{modelValue:s.value.desc,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.desc=o),autosize:{minRows:2,maxRows:5},type:"textarea"},null,8,["modelValue"])]),_:1}),t(f,{label:"段落设计"},{default:l(()=>[t(M,{data:s.value.paragraphs,"max-height":"386",border:!0},{default:l(()=>[t(V,{type:"index",align:"center"}),t(V,{label:"段落标题",align:"center"},{default:l(o=>[t(y,{modelValue:o.row.title,"onUpdate:modelValue":v=>o.row.title=v},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(V,{label:"段落文本",align:"center"},{default:l(o=>[t(y,{modelValue:o.row.desc,"onUpdate:modelValue":v=>o.row.desc=v,autosize:{minRows:1,maxRows:4},type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(V,{label:"操作",align:"center"},{default:l(o=>[t(n,{onClick:v=>C(o.row,o.$index),size:"small"},{default:l(()=>e[6]||(e[6]=[p("复制")])),_:2},1032,["onClick"]),t(E,{onConfirm:v=>U(o.$index),title:"确认要删除该项吗？","confirm-button-text":"确认","cancel-button-text":"取消"},{reference:l(()=>[t(n,{size:"small",type:"danger"},{default:l(()=>e[7]||(e[7]=[p("删除")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),t(f,null,{default:l(()=>[t(n,{onClick:e[2]||(e[2]=o=>C({title:"",desc:""},-1))},{default:l(()=>e[8]||(e[8]=[p("添加段落")])),_:1})]),_:1}),t(f,null,{default:l(()=>[t(n,{onClick:h},{default:l(()=>e[9]||(e[9]=[p("返回")])),_:1}),t(n,{type:"primary",onClick:I},{default:l(()=>[e[10]||(e[10]=m("span",null,"保存",-1)),m("span",Y,j(q(z)),1)]),_:1})]),_:1})]),_:1},8,["model"])])])}}},le=K(Z,[["__scopeId","data-v-47280992"]]);export{le as default};
